<div class="media-gallery-container">
    <div class="search-section">x
        <mat-form-field appearance="outline" class="search-field">
            <mat-label>Search Media</mat-label>
            <input matInput [formControl]="searchControl" placeholder="Enter search term...">
            <button mat-icon-button matSuffix (click)="onSearchClick()" [disabled]="isLoading$ | async">
                <mat-icon>search</mat-icon>
            </button>
        </mat-form-field>
    </div>

    @if (isLoading$ | async) {
        <div class="loading-section">
            <mat-icon class="spinning">refresh</mat-icon>
            <p>Loading...</p>
        </div>
    }

    @let results = searchResults$ | async;
    @if (results !== null && !( isLoading$ | async)) {
        @if (results.length === 0) {
            <div class="no-results">
                <mat-icon>search_off</mat-icon>
                <p>No media found</p>
            </div>
        } @else {
            <div class="results-section">
                <h3>Results ({{ results.length }})</h3>
                <div class="media-grid">
                    @for (item of results; track item.Path) {
                        <mat-card class="media-card">
                            <mat-card-content>
                                @if (isImage(item)) {
                                    <div class="media-preview">
                                        <img [src]="getMediaThumbnailUrl(item)" [alt]="getMediaTitle(item)" />
                                    </div>
                                } @else if (isVideo(item)) {
                                    <div class="media-preview">
                                        <video [src]="getMediaContentUrl(item)" controls></video>
                                    </div>
                                } @else if (isAudio(item)) {
                                    <div class="media-preview audio-preview">
                                        <mat-icon>audiotrack</mat-icon>
                                        <audio [src]="getMediaContentUrl(item)" controls></audio>
                                    </div>
                                } @else {
                                    <div class="media-preview file-preview">
                                        <mat-icon>insert_drive_file</mat-icon>
                                    </div>
                                }
                                <div class="media-info">
                                    <p class="media-path" [title]="getMediaTitle(item)">{{ getMediaFileName(item) }}</p>                                    
                                </div>
                            </mat-card-content>
                        </mat-card>
                    }
                </div>
            </div>
        }
    }
</div>
